<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .node rect { stroke: #999; stroke-width: 1.5px; }
  .husband { fill: #add8e6; }
  .wife { fill: #ffc0cb; }
  .link { fill: none; stroke: #ccc; stroke-width: 2px; }
  text { font: 12px sans-serif; }
</style>
<body>
<div id="tree"></div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  const treeData = __TREE_DATA__;
  console.log("ðŸŒ³ Tree Data Loaded:", treeData);

  const width = 1400;
  const dx = 100;
  const dy = 180;

  const treeLayout = d3.tree().nodeSize([dx, dy]);
  const root = d3.hierarchy(treeData);

  treeLayout(root);

  const svg = d3.select("#tree")
    .append("svg")
    .attr("viewBox", [-100, -50, width, 1000])
    .style("font", "12px sans-serif");

  const g = svg.append("g");

  // Links
  g.selectAll(".link")
    .data(root.links())
    .join("path")
    .attr("class", "link")
    .attr("d", d3.linkVertical()
      .x(d => d.x)
      .y(d => d.y));

  // Nodes
  const node = g.selectAll(".node")
    .data(root.descendants())
    .join("g")
    .attr("class", "node")
    .attr("transform", d => `translate(${d.x},${d.y})`);

  node.each(function(d) {
    const g = d3.select(this);
    if (d.data.type === "couple") {
      g.append("rect")
        .attr("x", -70).attr("y", -30).attr("width", 140).attr("height", 25)
        .attr("class", "husband");
      g.append("text")
        .attr("x", 0).attr("y", -12)
        .attr("text-anchor", "middle")
        .text(d.data.husband.name);

      g.append("rect")
        .attr("x", -70).attr("y", 0).attr("width", 140).attr("height", 25)
        .attr("class", "wife");
      g.append("text")
        .attr("x", 0).attr("y", 17)
        .attr("text-anchor", "middle")
        .text(d.data.wife.name);
    } else {
      g.append("rect")
        .attr("x", -70).attr("y", -15).attr("width", 140).attr("height", 30)
        .attr("fill", "#f9f9f9")
        .attr("stroke", "#333");
      g.append("text")
        .attr("x", 0).attr("y", 5)
        .attr("text-anchor", "middle")
        .text(d.data.name);
    }
  });
</script>
</body>
